<!DOCTYPE html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="alternate" type="text/markdown" href="date.rb.md">
    <style>
      body {
        max-width: 38rem;
        margin: auto;
        padding: 1rem;
        font-family: system-ui;
        color: black;
        background-color: white;
      }
      p {line-height: 1.4;}
      code {
      line-height: 1.4;
      }
      a.line_number {color:gray;}
      code pre {word-wrap: break-word;}
      code:hover {color:black;}
      @media (prefers-color-scheme: dark) {
body {color:white;background-color:black;}
}
h1, h2, h3 {font-weight:normal;}
    </style>
    <title>./lib/monkey_patching/date.rb</title>
  </head>
  <body><h1>A monkey patched Ruby date class to handle UK Parliament specific day types.</h1>
<code title='Line 4, ./lib/monkey_patching/date.rb'><pre><a name='4' class='line_number'> 4</a> class Date
</pre></code><h2>A set of methods to work out the type of a given day.</h2>
<h3>We want to check if this is a praying sitting day in the Commons.</h3>
<p>We use a naive definition of a sitting day: this includes a calendar day when the Commons sits, together with following calendar days if the Commons sat through the night.</p>
<p>For example: if the Commons sat on a Tuesday and continued to sit overnight into Wednesday, both Tuesday and Wednesday would count as praying sitting days. </p>
<p>If the Tuesday sitting lasted long enough to overlap the starting time of the Wednesday sitting, the Tuesday would be a parliamentary sitting day, but the Wednesday would not.</p>
<code title='Line 16, ./lib/monkey_patching/date.rb'><pre><a name='16' class='line_number'> 16</a>   def is_commons_praying_sitting_day?
</pre></code><code title='Line 17, ./lib/monkey_patching/date.rb'><pre><a name='17' class='line_number'> 17</a>     SittingDay.all.where( 'start_date <= ?',  self ).where( 'end_date >= ?',  self ).where( house_id: 1 ).first
</pre></code><code title='Line 18, ./lib/monkey_patching/date.rb'><pre><a name='18' class='line_number'> 18</a>   end
</pre></code><h3>We want to check if this is a praying sitting day in the Lords.</h3>
<p>We use a naive definition of a sitting day: this includes a calendar day when the Lords sits, together with following calendar days if the Lords sat through the night.</p>
<p>For example: if the Lords sat on a Tuesday and continued to sit overnight into Wednesday, both Tuesday and Wednesday would count as praying sitting days.</p>
<p>If the Tuesday sitting lasted long enough to overlap the starting time of the Wednesday sitting, the Tuesday would be a parliamentary sitting day, but the Wednesday would not.</p>
<code title='Line 28, ./lib/monkey_patching/date.rb'><pre><a name='28' class='line_number'> 28</a>   def is_lords_praying_sitting_day?
</pre></code><code title='Line 29, ./lib/monkey_patching/date.rb'><pre><a name='29' class='line_number'> 29</a>     SittingDay.all.where( 'start_date <= ?',  self ).where( 'end_date >= ?',  self ).where( house_id: 2 ).first
</pre></code><code title='Line 30, ./lib/monkey_patching/date.rb'><pre><a name='30' class='line_number'> 30</a>   end
</pre></code><h3>We want to check if this is a parliamentary sitting day in the Commons.</h3>
<p>We use a more strict definition of a sitting day. We don’t include dates for which the Commons continued sitting from a previous day, where the preceding day’s sitting overlapped with the next day’s programmed sitting.</p>
<code title='Line 36, ./lib/monkey_patching/date.rb'><pre><a name='36' class='line_number'> 36</a>   def is_commons_parliamentary_sitting_day?
</pre></code><code title='Line 37, ./lib/monkey_patching/date.rb'><pre><a name='37' class='line_number'> 37</a>     SittingDay.all.where( 'start_date = ?',  self ).where( house_id: 1 ).first
</pre></code><code title='Line 38, ./lib/monkey_patching/date.rb'><pre><a name='38' class='line_number'> 38</a>   end
</pre></code><h3>We want to check if this is a parliamentary sitting day in the Lords.</h3>
<p>We use a more strict definition of a sitting day. We don’t include dates for which the Lords continued sitting from a previous day, where the preceding day’s sitting overlapped with the next day’s programmed sitting.</p>
<code title='Line 44, ./lib/monkey_patching/date.rb'><pre><a name='44' class='line_number'> 44</a>   def is_lords_parliamentary_sitting_day?
</pre></code><code title='Line 45, ./lib/monkey_patching/date.rb'><pre><a name='45' class='line_number'> 45</a>     SittingDay.all.where( 'start_date = ?',  self ).where( house_id: 2 ).first
</pre></code><code title='Line 46, ./lib/monkey_patching/date.rb'><pre><a name='46' class='line_number'> 46</a>   end
</pre></code><h3>We want to check if this is a virtual sitting day in the Commons.</h3>
<p>This is a day where all Members of the House sit ‘digitally’, rather than physically.</p>
<p>A virtual sitting may continue over more than one calendar day. We count any continuation, where the preceding day’s sitting overlapped with the next day’s programmed sitting, as also being a virtual sitting day.</p>
<p>As of the end of June 2020, the Commons has had no virtual sitting days.</p>
<code title='Line 56, ./lib/monkey_patching/date.rb'><pre><a name='56' class='line_number'> 56</a>   def is_commons_virtual_sitting_day?
</pre></code><code title='Line 57, ./lib/monkey_patching/date.rb'><pre><a name='57' class='line_number'> 57</a>     VirtualSittingDay.all.where( 'start_date <= ?',  self ).where( 'end_date >= ?',  self ).where( house_id: 1 ).first
</pre></code><code title='Line 58, ./lib/monkey_patching/date.rb'><pre><a name='58' class='line_number'> 58</a>   end
</pre></code><h3>We want to check if this is a virtual sitting day in the Lords.</h3>
<p>This is a day where all Members of the House sit ‘digitally’, rather than physically.</p>
<p>A virtual sitting may continue over more than one calendar day. We count any continuation, where the preceding day’s sitting overlapped with the next day’s programmed sitting, as also being a virtual sitting day.</p>
<code title='Line 66, ./lib/monkey_patching/date.rb'><pre><a name='66' class='line_number'> 66</a>   def is_lords_virtual_sitting_day?
</pre></code><code title='Line 67, ./lib/monkey_patching/date.rb'><pre><a name='67' class='line_number'> 67</a>     VirtualSittingDay.all.where( 'start_date <= ?',  self ).where( 'end_date >= ?',  self ).where( house_id: 2 ).first
</pre></code><code title='Line 68, ./lib/monkey_patching/date.rb'><pre><a name='68' class='line_number'> 68</a>   end
</pre></code><h3>We want to check if this is a praying sitting day in either House.</h3>
<code title='Line 72, ./lib/monkey_patching/date.rb'><pre><a name='72' class='line_number'> 72</a>   def is_either_house_praying_sitting_day?
</pre></code><code title='Line 73, ./lib/monkey_patching/date.rb'><pre><a name='73' class='line_number'> 73</a>     self.is_commons_praying_sitting_day? or self.is_lords_praying_sitting_day?
</pre></code><code title='Line 74, ./lib/monkey_patching/date.rb'><pre><a name='74' class='line_number'> 74</a>   end
</pre></code><h3>We want to check if this is a praying sitting day in both Houses.</h3>
<code title='Line 78, ./lib/monkey_patching/date.rb'><pre><a name='78' class='line_number'> 78</a>   def is_joint_praying_sitting_day?
</pre></code><code title='Line 79, ./lib/monkey_patching/date.rb'><pre><a name='79' class='line_number'> 79</a>     self.is_commons_praying_sitting_day? and self.is_lords_praying_sitting_day?
</pre></code><code title='Line 80, ./lib/monkey_patching/date.rb'><pre><a name='80' class='line_number'> 80</a>   end
</pre></code><h3>We want to check if this is a parliamentary sitting day in either House.</h3>
<code title='Line 84, ./lib/monkey_patching/date.rb'><pre><a name='84' class='line_number'> 84</a>   def is_either_house_parliamentary_sitting_day?
</pre></code><code title='Line 85, ./lib/monkey_patching/date.rb'><pre><a name='85' class='line_number'> 85</a>     self.is_commons_parliamentary_sitting_day? or self.is_lords_parliamentary_sitting_day?
</pre></code><code title='Line 86, ./lib/monkey_patching/date.rb'><pre><a name='86' class='line_number'> 86</a>   end
</pre></code><h3>We want to check if this is a parliamentary sitting day in both Houses.</h3>
<code title='Line 90, ./lib/monkey_patching/date.rb'><pre><a name='90' class='line_number'> 90</a>   def is_joint_parliamentary_sitting_day?
</pre></code><code title='Line 91, ./lib/monkey_patching/date.rb'><pre><a name='91' class='line_number'> 91</a>     self.is_commons_parliamentary_sitting_day? and self.is_lords_parliamentary_sitting_day?
</pre></code><code title='Line 92, ./lib/monkey_patching/date.rb'><pre><a name='92' class='line_number'> 92</a>   end
</pre></code><h3>We want to check if this is an adjournment day in either House.</h3>
<code title='Line 96, ./lib/monkey_patching/date.rb'><pre><a name='96' class='line_number'> 96</a>   def is_adjournment_day?
</pre></code><code title='Line 97, ./lib/monkey_patching/date.rb'><pre><a name='97' class='line_number'> 97</a>     AdjournmentDay.all.where( 'date = ?',  self ).first
</pre></code><code title='Line 98, ./lib/monkey_patching/date.rb'><pre><a name='98' class='line_number'> 98</a>   end
</pre></code><h3>We want to check if this is an adjournment day in the Commons.</h3>
<code title='Line 102, ./lib/monkey_patching/date.rb'><pre><a name='102' class='line_number'> 102</a>   def is_commons_adjournment_day?
</pre></code><code title='Line 103, ./lib/monkey_patching/date.rb'><pre><a name='103' class='line_number'> 103</a>     AdjournmentDay.all.where( 'date = ?',  self ).where( house_id: 1 ).first
</pre></code><code title='Line 104, ./lib/monkey_patching/date.rb'><pre><a name='104' class='line_number'> 104</a>   end
</pre></code><h3>We want to check if this is an adjournment day in the Lords.</h3>
<code title='Line 108, ./lib/monkey_patching/date.rb'><pre><a name='108' class='line_number'> 108</a>   def is_lords_adjournment_day?
</pre></code><code title='Line 109, ./lib/monkey_patching/date.rb'><pre><a name='109' class='line_number'> 109</a>     AdjournmentDay.all.where( 'date = ?',  self ).where( house_id: 2 ).first
</pre></code><code title='Line 110, ./lib/monkey_patching/date.rb'><pre><a name='110' class='line_number'> 110</a>   end
</pre></code><h3>We want to check if Parliament is prorogued on this day.</h3>
<code title='Line 114, ./lib/monkey_patching/date.rb'><pre><a name='114' class='line_number'> 114</a>   def is_prorogation_day?
</pre></code><code title='Line 115, ./lib/monkey_patching/date.rb'><pre><a name='115' class='line_number'> 115</a>     ProrogationDay.all.where( 'date = ?',  self ).first
</pre></code><code title='Line 116, ./lib/monkey_patching/date.rb'><pre><a name='116' class='line_number'> 116</a>   end
</pre></code><h3>We want to check if Parliament is dissolved on this day.</h3>
<code title='Line 120, ./lib/monkey_patching/date.rb'><pre><a name='120' class='line_number'> 120</a>   def is_dissolution_day?
</pre></code><code title='Line 121, ./lib/monkey_patching/date.rb'><pre><a name='121' class='line_number'> 121</a>     DissolutionDay.all.where( 'date = ?',  self ).first
</pre></code><code title='Line 122, ./lib/monkey_patching/date.rb'><pre><a name='122' class='line_number'> 122</a>   end
</pre></code><h3>We want to check if this is a day for which we have something in the calendar.</h3>
<p>That might be a parliamentary sitting day, a praying sitting day, a virtual sitting day, an adjournment day, a day within prorogation or a day within dissolution.</p>
<code title='Line 128, ./lib/monkey_patching/date.rb'><pre><a name='128' class='line_number'> 128</a>   def is_calendar_populated?
</pre></code><code title='Line 129, ./lib/monkey_patching/date.rb'><pre><a name='129' class='line_number'> 129</a>     self.is_commons_praying_sitting_day? or self.is_lords_praying_sitting_day? or self.is_commons_virtual_sitting_day? or self.is_lords_virtual_sitting_day? or self.is_adjournment_day? or self.is_prorogation_day? or self.is_dissolution_day?
</pre></code><code title='Line 130, ./lib/monkey_patching/date.rb'><pre><a name='130' class='line_number'> 130</a>   end
</pre></code><h3>We want to check if this is a day for which we do not have anything in the calendar.</h3>
<p>We use this to check if we&#39;ve <q>run out of calendar</q> so we don&#39;t keep cycling into future days and loop infinitely.</p>
<p>This is our event horizon.</p>
<code title='Line 138, ./lib/monkey_patching/date.rb'><pre><a name='138' class='line_number'> 138</a>   def is_calendar_not_populated?
</pre></code><code title='Line 139, ./lib/monkey_patching/date.rb'><pre><a name='139' class='line_number'> 139</a>     !self.is_calendar_populated?
</pre></code><code title='Line 140, ./lib/monkey_patching/date.rb'><pre><a name='140' class='line_number'> 140</a>   end
</pre></code><h3>We want to check if this is a praying adjournment day in the Commons.</h3>
<p>During a short adjournment, adjournment days are praying days.</p>
<p>This method allows the definition of a “short” adjournment to be adjusted by passing in a maximum day count.</p>
<p>In all known cases “short” is defined as not more than four days.</p>
<p>For the purposes of calculating praying days, virtual sitting days count as adjournment days.</p>
<code title='Line 152, ./lib/monkey_patching/date.rb'><pre><a name='152' class='line_number'> 152</a>   def is_commons_praying_adjournment_day?( maximum_day_count )
</pre></code><h3>We want to check if this is a Commons adjournnment day or a Commons virtual sitting day.</h3>
<code title='Line 156, ./lib/monkey_patching/date.rb'><pre><a name='156' class='line_number'> 156</a>     if self.is_commons_adjournment_day? or self.is_commons_virtual_sitting_day?
</pre></code><p>Having found that this is a Commons adjournnment day or a Commons virtual sitting day, we start the adjournment day count at 1.</p>
<code title='Line 160, ./lib/monkey_patching/date.rb'><pre><a name='160' class='line_number'> 160</a>       adjournment_day_count = 1
</pre></code><p>We want to cycle through the following days until we reach the maximum day count passed into this function.</p>
<code title='Line 164, ./lib/monkey_patching/date.rb'><pre><a name='164' class='line_number'> 164</a>       date = self
</pre></code><code title='Line 165, ./lib/monkey_patching/date.rb'><pre><a name='165' class='line_number'> 165</a>       for i in ( 1..maximum_day_count )
</pre></code><p>Go forward one day.</p>
<code title='Line 169, ./lib/monkey_patching/date.rb'><pre><a name='169' class='line_number'> 169</a>         date = date.next_day
</pre></code><p>If this is a Commons adjournnment day or a Commons virtual sitting day ...</p>
<code title='Line 172, ./lib/monkey_patching/date.rb'><pre><a name='172' class='line_number'> 172</a>         if date.is_commons_adjournment_day? or date.is_commons_virtual_sitting_day?
</pre></code><p>... add one to the adjournment day count.</p>
<code title='Line 175, ./lib/monkey_patching/date.rb'><pre><a name='175' class='line_number'> 175</a>           adjournment_day_count +=1
</pre></code><p>If this is not a Commons adjournnment day or a Commons virtual sitting day ...</p>
<code title='Line 178, ./lib/monkey_patching/date.rb'><pre><a name='178' class='line_number'> 178</a>         else
</pre></code><p>... stop cycling through following days.</p>
<code title='Line 181, ./lib/monkey_patching/date.rb'><pre><a name='181' class='line_number'> 181</a>           break
</pre></code><code title='Line 182, ./lib/monkey_patching/date.rb'><pre><a name='182' class='line_number'> 182</a>         end
</pre></code><code title='Line 183, ./lib/monkey_patching/date.rb'><pre><a name='183' class='line_number'> 183</a>       end
</pre></code><p>We want to cycle through the preceding days until we reach the maximum day count passed into this function.</p>
<code title='Line 186, ./lib/monkey_patching/date.rb'><pre><a name='186' class='line_number'> 186</a>       date = self
</pre></code><code title='Line 187, ./lib/monkey_patching/date.rb'><pre><a name='187' class='line_number'> 187</a>       for i in ( 1..maximum_day_count )
</pre></code><p>Go back one day.</p>
<code title='Line 190, ./lib/monkey_patching/date.rb'><pre><a name='190' class='line_number'> 190</a>         date = date.prev_day
</pre></code><p>If this is a Commons adjournnment day or a Commons virtual sitting day ...</p>
<code title='Line 193, ./lib/monkey_patching/date.rb'><pre><a name='193' class='line_number'> 193</a>         if date.is_commons_adjournment_day? or date.is_commons_virtual_sitting_day?
</pre></code><p>... add one to the adjournment day count.</p>
<code title='Line 196, ./lib/monkey_patching/date.rb'><pre><a name='196' class='line_number'> 196</a>           adjournment_day_count +=1
</pre></code><p>If this is not a Commons adjournnment day or a Commons virtual sitting day ...</p>
<code title='Line 199, ./lib/monkey_patching/date.rb'><pre><a name='199' class='line_number'> 199</a>         else  
</pre></code><p>... stop cycling through preceding days.</p>
<code title='Line 202, ./lib/monkey_patching/date.rb'><pre><a name='202' class='line_number'> 202</a>           break
</pre></code><code title='Line 203, ./lib/monkey_patching/date.rb'><pre><a name='203' class='line_number'> 203</a>         end
</pre></code><code title='Line 204, ./lib/monkey_patching/date.rb'><pre><a name='204' class='line_number'> 204</a>       end
</pre></code><p>If the total number of continuous adjournment days is more than the maximum day count ...</p>
<code title='Line 207, ./lib/monkey_patching/date.rb'><pre><a name='207' class='line_number'> 207</a>       if adjournment_day_count > maximum_day_count
</pre></code><p>... then this day is not part of a short adjournment and so does not count as a praying day.</p>
<code title='Line 210, ./lib/monkey_patching/date.rb'><pre><a name='210' class='line_number'> 210</a>         is_commons_short_adjournment = false
</pre></code><p>If the total number of continuous adjournment days is less than or the same as the maximum day count ...</p>
<code title='Line 213, ./lib/monkey_patching/date.rb'><pre><a name='213' class='line_number'> 213</a>       else
</pre></code><p>... then this day is part of a short adjournment and so does count as a praying day.</p>
<code title='Line 216, ./lib/monkey_patching/date.rb'><pre><a name='216' class='line_number'> 216</a>         is_commons_short_adjournment = true
</pre></code><code title='Line 217, ./lib/monkey_patching/date.rb'><pre><a name='217' class='line_number'> 217</a>       end
</pre></code><p>Returns if this day is a part of a Commons short adjournment</p>
<code title='Line 220, ./lib/monkey_patching/date.rb'><pre><a name='220' class='line_number'> 220</a>       is_commons_short_adjournment
</pre></code><code title='Line 221, ./lib/monkey_patching/date.rb'><pre><a name='221' class='line_number'> 221</a>     end
</pre></code><code title='Line 222, ./lib/monkey_patching/date.rb'><pre><a name='222' class='line_number'> 222</a>   end
</pre></code><h3>We want to check if this is a praying day in the Commons.</h3>
<p>A praying day in the Commons is either a praying sitting day in the Commons, or a praying adjournment day in the Commons.</p>
<p>We pass &#39;4&#39; as the maximum day count to the adjournment day calculation, because praying adjournment days are days within a series of not more than four adjournment days.</p>
<code title='Line 230, ./lib/monkey_patching/date.rb'><pre><a name='230' class='line_number'> 230</a>   def is_commons_praying_day?
</pre></code><code title='Line 231, ./lib/monkey_patching/date.rb'><pre><a name='231' class='line_number'> 231</a>     self.is_commons_praying_sitting_day? or self.is_commons_praying_adjournment_day?( 4 )
</pre></code><code title='Line 232, ./lib/monkey_patching/date.rb'><pre><a name='232' class='line_number'> 232</a>   end
</pre></code><h3>We want to check if this is a praying adjournment day in the Lords.</h3>
<p>During a short adjournment, adjournment days are praying days.</p>
<p>This method allows the definition of a “short” adjournment to be adjusted by passing in a maximum day count.</p>
<p>In all known cases “short” is defined as not more than four days.</p>
<p>For the purposes of calculating praying days, virtual sitting days count as adjournment days.</p>
<code title='Line 244, ./lib/monkey_patching/date.rb'><pre><a name='244' class='line_number'> 244</a>   def is_lords_praying_adjournment_day?( maximum_day_count )
</pre></code><p>We want to check if this is a Lords adjournnment day or a Lords virtual sitting day.</p>
<code title='Line 247, ./lib/monkey_patching/date.rb'><pre><a name='247' class='line_number'> 247</a>     if self.is_lords_adjournment_day? or self.is_lords_virtual_sitting_day?
</pre></code><p>Having found that this is a Lords adjournnment day or a Lords virtual sitting day, we start the adjournment day count at 1.</p>
<code title='Line 250, ./lib/monkey_patching/date.rb'><pre><a name='250' class='line_number'> 250</a>       adjournment_day_count = 1
</pre></code><p>We want to cycle through the following days until we reach the maximum day count passed into this function.</p>
<code title='Line 253, ./lib/monkey_patching/date.rb'><pre><a name='253' class='line_number'> 253</a>       date = self
</pre></code><code title='Line 254, ./lib/monkey_patching/date.rb'><pre><a name='254' class='line_number'> 254</a>       for i in ( 1..maximum_day_count )
</pre></code><p>Go forward one day.</p>
<code title='Line 257, ./lib/monkey_patching/date.rb'><pre><a name='257' class='line_number'> 257</a>         date = date.next_day
</pre></code><p>If this is a Lords adjournnment day or a Lords virtual sitting day ...</p>
<code title='Line 260, ./lib/monkey_patching/date.rb'><pre><a name='260' class='line_number'> 260</a>         if date.is_lords_adjournment_day? or date.is_lords_virtual_sitting_day?
</pre></code><p>... add one to the adjournment day count.</p>
<code title='Line 263, ./lib/monkey_patching/date.rb'><pre><a name='263' class='line_number'> 263</a>           adjournment_day_count +=1
</pre></code><p>If this is not a Lords adjournnment day or a Lords virtual sitting day ...</p>
<code title='Line 266, ./lib/monkey_patching/date.rb'><pre><a name='266' class='line_number'> 266</a>         else
</pre></code><p>... stop cycling through following days.</p>
<code title='Line 269, ./lib/monkey_patching/date.rb'><pre><a name='269' class='line_number'> 269</a>           break
</pre></code><code title='Line 270, ./lib/monkey_patching/date.rb'><pre><a name='270' class='line_number'> 270</a>         end
</pre></code><code title='Line 271, ./lib/monkey_patching/date.rb'><pre><a name='271' class='line_number'> 271</a>       end
</pre></code><p>We want to cycle through the preceding days until we reach the maximum day count passed into this function.</p>
<code title='Line 274, ./lib/monkey_patching/date.rb'><pre><a name='274' class='line_number'> 274</a>       date = self
</pre></code><code title='Line 275, ./lib/monkey_patching/date.rb'><pre><a name='275' class='line_number'> 275</a>       for i in ( 1..maximum_day_count )
</pre></code><p>Go back one day.</p>
<code title='Line 278, ./lib/monkey_patching/date.rb'><pre><a name='278' class='line_number'> 278</a>         date = date.prev_day
</pre></code><p>If this is a Lords adjournnment day or a Lords virtual sitting day ...</p>
<code title='Line 281, ./lib/monkey_patching/date.rb'><pre><a name='281' class='line_number'> 281</a>         if date.is_lords_adjournment_day? or date.is_lords_virtual_sitting_day?
</pre></code><p>... add one to the adjournment day count.</p>
<code title='Line 284, ./lib/monkey_patching/date.rb'><pre><a name='284' class='line_number'> 284</a>           adjournment_day_count +=1
</pre></code><p>If this is not a Lords adjournnment day or a Lords virtual sitting day ...</p>
<code title='Line 287, ./lib/monkey_patching/date.rb'><pre><a name='287' class='line_number'> 287</a>         else  
</pre></code><p>... stop cycling through preceding days.</p>
<code title='Line 290, ./lib/monkey_patching/date.rb'><pre><a name='290' class='line_number'> 290</a>           break
</pre></code><code title='Line 291, ./lib/monkey_patching/date.rb'><pre><a name='291' class='line_number'> 291</a>         end
</pre></code><code title='Line 292, ./lib/monkey_patching/date.rb'><pre><a name='292' class='line_number'> 292</a>       end
</pre></code><p>If the total number of continuous adjournment days is more than the maximum day count ...</p>
<code title='Line 295, ./lib/monkey_patching/date.rb'><pre><a name='295' class='line_number'> 295</a>       if adjournment_day_count > maximum_day_count
</pre></code><p>... then this day is not part of a short adjournment and so does not count as a praying day.</p>
<code title='Line 298, ./lib/monkey_patching/date.rb'><pre><a name='298' class='line_number'> 298</a>         is_lords_short_adjournment = false
</pre></code><p>If the total number of continuous adjournment days is less than or the same as the maximum day count ...</p>
<code title='Line 301, ./lib/monkey_patching/date.rb'><pre><a name='301' class='line_number'> 301</a>       else
</pre></code><p>... then this day is part of a short adjournment and so does count as a praying day.</p>
<code title='Line 304, ./lib/monkey_patching/date.rb'><pre><a name='304' class='line_number'> 304</a>         is_lords_short_adjournment = true
</pre></code><code title='Line 305, ./lib/monkey_patching/date.rb'><pre><a name='305' class='line_number'> 305</a>       end
</pre></code><p>Returns if this day is a part of a Lords short adjournment</p>
<code title='Line 308, ./lib/monkey_patching/date.rb'><pre><a name='308' class='line_number'> 308</a>       is_lords_short_adjournment
</pre></code><code title='Line 309, ./lib/monkey_patching/date.rb'><pre><a name='309' class='line_number'> 309</a>     end
</pre></code><code title='Line 310, ./lib/monkey_patching/date.rb'><pre><a name='310' class='line_number'> 310</a>   end
</pre></code><h3>We want to check if this is a praying day in the Lords.</h3>
<p>A praying day in the Lords is either a praying sitting day in the Lords, or a praying adjournment day in the Lords.</p>
<p>We pass &#39;4&#39; as the maximum day count to the adjournment day calculation, because praying adjournment days are days within a series of not more than four adjournment days.</p>
<code title='Line 318, ./lib/monkey_patching/date.rb'><pre><a name='318' class='line_number'> 318</a>   def is_lords_praying_day?
</pre></code><code title='Line 319, ./lib/monkey_patching/date.rb'><pre><a name='319' class='line_number'> 319</a>     self.is_lords_praying_sitting_day? or self.is_lords_praying_adjournment_day?( 4 )
</pre></code><code title='Line 320, ./lib/monkey_patching/date.rb'><pre><a name='320' class='line_number'> 320</a>   end
</pre></code><h3>We want to check if this is a praying day in either House.</h3>
<code title='Line 324, ./lib/monkey_patching/date.rb'><pre><a name='324' class='line_number'> 324</a>   def is_either_house_praying_day?
</pre></code><code title='Line 325, ./lib/monkey_patching/date.rb'><pre><a name='325' class='line_number'> 325</a>     self.is_commons_praying_day? or self.is_lords_praying_day?
</pre></code><code title='Line 326, ./lib/monkey_patching/date.rb'><pre><a name='326' class='line_number'> 326</a>   end
</pre></code><h3>We want to check if this is a praying day in both Houses.</h3>
<code title='Line 330, ./lib/monkey_patching/date.rb'><pre><a name='330' class='line_number'> 330</a>   def is_joint_praying_day?
</pre></code><code title='Line 331, ./lib/monkey_patching/date.rb'><pre><a name='331' class='line_number'> 331</a>     self.is_commons_praying_day? and self.is_lords_praying_day?
</pre></code><code title='Line 332, ./lib/monkey_patching/date.rb'><pre><a name='332' class='line_number'> 332</a>   end
</pre></code><p>(End of set of methods to work out the type of a given day.)</p>
<h2>A set of methods to find the first day of a given type.</h2>
<h3>We want to find the first praying day in either House.</h3>
<p>This method is used when a Statutory Instrument is not laid in a praying period, that is: during an adjournment of more than four days, or during a period in which Parliament is prorogued. In such cases, the clock starts from the first praying sitting day in either House following the laying.</p>
<p>This method is used for bicameral negative SIs - and bicameral made affirmatives where the enabling legislation specifies that either House can be sitting.</p>
<code title='Line 346, ./lib/monkey_patching/date.rb'><pre><a name='346' class='line_number'> 346</a>   def first_praying_day_in_either_house
</pre></code><p>If this is a day on which the calendar is not yet populated ...</p>
<code title='Line 349, ./lib/monkey_patching/date.rb'><pre><a name='349' class='line_number'> 349</a>     if self.is_calendar_not_populated?
</pre></code><p>... then we cannot find a first praying day so we stop looking.</p>
<code title='Line 352, ./lib/monkey_patching/date.rb'><pre><a name='352' class='line_number'> 352</a>       return nil
</pre></code><p>If this is a day on which the calendar is populated ...</p>
<code title='Line 355, ./lib/monkey_patching/date.rb'><pre><a name='355' class='line_number'> 355</a>     else
</pre></code><p>... then if this is not a praying day in either House ...</p>
<code title='Line 358, ./lib/monkey_patching/date.rb'><pre><a name='358' class='line_number'> 358</a>       unless self.is_either_house_praying_day?
</pre></code><p>... then go to the next day and check that.</p>
<code title='Line 361, ./lib/monkey_patching/date.rb'><pre><a name='361' class='line_number'> 361</a>         self.next_day.first_praying_day_in_either_house
</pre></code><p>... then if this is a praying day in either House ...</p>
<code title='Line 364, ./lib/monkey_patching/date.rb'><pre><a name='364' class='line_number'> 364</a>       else
</pre></code><p>... then return this day as the first praying day in either House.</p>
<code title='Line 367, ./lib/monkey_patching/date.rb'><pre><a name='367' class='line_number'> 367</a>         self
</pre></code><code title='Line 368, ./lib/monkey_patching/date.rb'><pre><a name='368' class='line_number'> 368</a>       end
</pre></code><code title='Line 369, ./lib/monkey_patching/date.rb'><pre><a name='369' class='line_number'> 369</a>     end
</pre></code><code title='Line 370, ./lib/monkey_patching/date.rb'><pre><a name='370' class='line_number'> 370</a>   end
</pre></code><h3>We want to find the first praying day in both Houses.</h3>
<p>This method is used when a Statutory Instrument is not laid in a praying period, that is: during an adjournment of more than four days, or during a period in which Parliament is prorogued. The clock starts from the first praying sitting day in both Houses following the laying.</p>
<p>This method is used for bicameral made affirmatives where the enabling legislation specifies that both Houses must be sitting.</p>
<code title='Line 378, ./lib/monkey_patching/date.rb'><pre><a name='378' class='line_number'> 378</a>   def first_joint_praying_day
</pre></code><p>If this is a day on which the calendar is not yet populated ...</p>
<code title='Line 381, ./lib/monkey_patching/date.rb'><pre><a name='381' class='line_number'> 381</a>     if self.is_calendar_not_populated?
</pre></code><p>... then we cannot find a first praying day so we stop looking.</p>
<code title='Line 384, ./lib/monkey_patching/date.rb'><pre><a name='384' class='line_number'> 384</a>       return nil
</pre></code><p>If this is a day on which the calendar is populated ...</p>
<code title='Line 387, ./lib/monkey_patching/date.rb'><pre><a name='387' class='line_number'> 387</a>     else
</pre></code><p>... then if this is not a praying day in both Houses ...</p>
<code title='Line 390, ./lib/monkey_patching/date.rb'><pre><a name='390' class='line_number'> 390</a>       unless self.is_joint_praying_day?
</pre></code><p>... then go to the next day and check that.</p>
<code title='Line 393, ./lib/monkey_patching/date.rb'><pre><a name='393' class='line_number'> 393</a>         self.next_day.first_joint_praying_day
</pre></code><p>... then if this is a praying day in both Houses ...</p>
<code title='Line 396, ./lib/monkey_patching/date.rb'><pre><a name='396' class='line_number'> 396</a>       else
</pre></code><p>... then return this day as the first praying day in both Houses.</p>
<code title='Line 399, ./lib/monkey_patching/date.rb'><pre><a name='399' class='line_number'> 399</a>         self
</pre></code><code title='Line 400, ./lib/monkey_patching/date.rb'><pre><a name='400' class='line_number'> 400</a>       end
</pre></code><code title='Line 401, ./lib/monkey_patching/date.rb'><pre><a name='401' class='line_number'> 401</a>     end
</pre></code><code title='Line 402, ./lib/monkey_patching/date.rb'><pre><a name='402' class='line_number'> 402</a>   end
</pre></code><h3>We want to find the first praying day in the Commons.</h3>
<p>This method is used when a Statutory Instrument is not laid in a praying period, that is: during an adjournment of more than four days, or during a period in which Parliament is prorogued. The clock starts from the first praying sitting day in the Commons following the laying.</p>
<p>This method is used for negative or made affirmative SIs - laid in the Commons and not laid in the Lords.</p>
<code title='Line 410, ./lib/monkey_patching/date.rb'><pre><a name='410' class='line_number'> 410</a>   def first_commons_praying_day
</pre></code><p>If this is a day on which the calendar is not yet populated ...</p>
<code title='Line 413, ./lib/monkey_patching/date.rb'><pre><a name='413' class='line_number'> 413</a>     if self.is_calendar_not_populated?
</pre></code><p>... then we cannot find a first Commons praying day so we stop looking.</p>
<code title='Line 416, ./lib/monkey_patching/date.rb'><pre><a name='416' class='line_number'> 416</a>       return nil
</pre></code><p>If this is a day on which the calendar is populated ...</p>
<code title='Line 419, ./lib/monkey_patching/date.rb'><pre><a name='419' class='line_number'> 419</a>     else
</pre></code><p>... then if this is not a praying day in the Commons ...</p>
<code title='Line 422, ./lib/monkey_patching/date.rb'><pre><a name='422' class='line_number'> 422</a>       unless self.is_commons_praying_day?
</pre></code><p>... then go to the next day and check that.</p>
<code title='Line 425, ./lib/monkey_patching/date.rb'><pre><a name='425' class='line_number'> 425</a>         self.next_day.first_commons_praying_day
</pre></code><p>... then if this is a praying day in the Commons ...</p>
<code title='Line 428, ./lib/monkey_patching/date.rb'><pre><a name='428' class='line_number'> 428</a>       else
</pre></code><p>... then return this day as the first praying day in the Commons.</p>
<code title='Line 431, ./lib/monkey_patching/date.rb'><pre><a name='431' class='line_number'> 431</a>         self
</pre></code><code title='Line 432, ./lib/monkey_patching/date.rb'><pre><a name='432' class='line_number'> 432</a>       end
</pre></code><code title='Line 433, ./lib/monkey_patching/date.rb'><pre><a name='433' class='line_number'> 433</a>     end
</pre></code><code title='Line 434, ./lib/monkey_patching/date.rb'><pre><a name='434' class='line_number'> 434</a>   end
</pre></code><h3>We want to find the first parliamentary sitting day in both Houses.</h3>
<p>This method is used when a Proposed Negative Statutory Instrument is laid.</p>
<p>Even if a PNSI is laid on a joint parliamentary sitting day, the clock does not start until the next joint parliamentary sitting day.</p>
<code title='Line 442, ./lib/monkey_patching/date.rb'><pre><a name='442' class='line_number'> 442</a>   def first_joint_parliamentary_sitting_day
</pre></code><p>If this is a day on which the calendar is not yet populated ...</p>
<code title='Line 445, ./lib/monkey_patching/date.rb'><pre><a name='445' class='line_number'> 445</a>     if self.is_calendar_not_populated?
</pre></code><p>... then we cannot find a first parliamentary sitting day in both Houses so we stop looking.</p>
<code title='Line 448, ./lib/monkey_patching/date.rb'><pre><a name='448' class='line_number'> 448</a>       return nil
</pre></code><p>If this is a day on which the calendar is populated ...</p>
<code title='Line 451, ./lib/monkey_patching/date.rb'><pre><a name='451' class='line_number'> 451</a>     else
</pre></code><p>... then if this is not a parliamentary sitting day in both Houses ...</p>
<code title='Line 454, ./lib/monkey_patching/date.rb'><pre><a name='454' class='line_number'> 454</a>       unless self.is_joint_parliamentary_sitting_day?
</pre></code><p>... then go to the next day and check that.</p>
<code title='Line 457, ./lib/monkey_patching/date.rb'><pre><a name='457' class='line_number'> 457</a>         self.next_day.first_joint_parliamentary_sitting_day
</pre></code><p>... then if this is a parliamentary sitting day in both Houses ...</p>
<code title='Line 460, ./lib/monkey_patching/date.rb'><pre><a name='460' class='line_number'> 460</a>       else
</pre></code><p>... then return this day as the first parliamentary sitting day in both Houses.</p>
<code title='Line 463, ./lib/monkey_patching/date.rb'><pre><a name='463' class='line_number'> 463</a>         self
</pre></code><code title='Line 464, ./lib/monkey_patching/date.rb'><pre><a name='464' class='line_number'> 464</a>       end
</pre></code><code title='Line 465, ./lib/monkey_patching/date.rb'><pre><a name='465' class='line_number'> 465</a>     end
</pre></code><code title='Line 466, ./lib/monkey_patching/date.rb'><pre><a name='466' class='line_number'> 466</a>   end
</pre></code><h3>We want to find the first parliamentary sitting day in the Commons.</h3>
<p>This method is used when a motion to not ratify a treaty in either House is approved - and the Government make a statement that the treaty should nonetheless be ratified, triggering treaty scrutiny period B.</p>
<p>Treaty scrutiny period B starts on the first Commons parliamentary sitting day following the date of the Government statement.</p>
<code title='Line 474, ./lib/monkey_patching/date.rb'><pre><a name='474' class='line_number'> 474</a>   def first_commons_parliamentary_sitting_day
</pre></code><p>If this is a day on which the calendar is not yet populated ...</p>
<code title='Line 477, ./lib/monkey_patching/date.rb'><pre><a name='477' class='line_number'> 477</a>     if self.is_calendar_not_populated?
</pre></code><p>... then we cannot find a first parliamentary sitting day in the Commons so we stop looking.</p>
<code title='Line 480, ./lib/monkey_patching/date.rb'><pre><a name='480' class='line_number'> 480</a>       return nil
</pre></code><p>If this is a day on which the calendar is populated ...</p>
<code title='Line 483, ./lib/monkey_patching/date.rb'><pre><a name='483' class='line_number'> 483</a>     else
</pre></code><p>... then if this is not a parliamentary sitting day in the Commons ...</p>
<code title='Line 486, ./lib/monkey_patching/date.rb'><pre><a name='486' class='line_number'> 486</a>       unless self.is_commons_parliamentary_sitting_day?
</pre></code><p>... then go to the next day and check that.</p>
<code title='Line 489, ./lib/monkey_patching/date.rb'><pre><a name='489' class='line_number'> 489</a>         self.next_day.first_commons_parliamentary_sitting_day
</pre></code><p>... then if this is a parliamentary sitting day in the Commons ...</p>
<code title='Line 492, ./lib/monkey_patching/date.rb'><pre><a name='492' class='line_number'> 492</a>       else
</pre></code><p>... then return this day as the first parliamentary sitting day in the Commons.</p>
<code title='Line 495, ./lib/monkey_patching/date.rb'><pre><a name='495' class='line_number'> 495</a>         self
</pre></code><code title='Line 496, ./lib/monkey_patching/date.rb'><pre><a name='496' class='line_number'> 496</a>       end
</pre></code><code title='Line 497, ./lib/monkey_patching/date.rb'><pre><a name='497' class='line_number'> 497</a>     end
</pre></code><code title='Line 498, ./lib/monkey_patching/date.rb'><pre><a name='498' class='line_number'> 498</a>   end
</pre></code><p>(End of set of methods to find the first day of a given type.)</p>
<p>Generate label for the day type in the Commons in a session.</p>
<code title='Line 503, ./lib/monkey_patching/date.rb'><pre><a name='503' class='line_number'> 503</a>   def commons_day_type
</pre></code><code title='Line 504, ./lib/monkey_patching/date.rb'><pre><a name='504' class='line_number'> 504</a>     if self.is_commons_parliamentary_sitting_day?
</pre></code><code title='Line 505, ./lib/monkey_patching/date.rb'><pre><a name='505' class='line_number'> 505</a>       day_type = 'Sitting day'
</pre></code><code title='Line 506, ./lib/monkey_patching/date.rb'><pre><a name='506' class='line_number'> 506</a>     elsif self.is_commons_virtual_sitting_day?
</pre></code><code title='Line 507, ./lib/monkey_patching/date.rb'><pre><a name='507' class='line_number'> 507</a>       day_type = 'Virtual sitting day'
</pre></code><code title='Line 508, ./lib/monkey_patching/date.rb'><pre><a name='508' class='line_number'> 508</a>     elsif self.is_commons_praying_sitting_day?
</pre></code><code title='Line 509, ./lib/monkey_patching/date.rb'><pre><a name='509' class='line_number'> 509</a>       day_type = "Sitting praying day"
</pre></code><code title='Line 510, ./lib/monkey_patching/date.rb'><pre><a name='510' class='line_number'> 510</a>     elsif self.is_commons_praying_adjournment_day?( 4 )
</pre></code><code title='Line 511, ./lib/monkey_patching/date.rb'><pre><a name='511' class='line_number'> 511</a>       day_type = 'Praying adjournment day'
</pre></code><code title='Line 512, ./lib/monkey_patching/date.rb'><pre><a name='512' class='line_number'> 512</a>     elsif self.is_commons_adjournment_day?
</pre></code><code title='Line 513, ./lib/monkey_patching/date.rb'><pre><a name='513' class='line_number'> 513</a>       day_type = 'Adjournment day'
</pre></code><code title='Line 514, ./lib/monkey_patching/date.rb'><pre><a name='514' class='line_number'> 514</a>     end
</pre></code><code title='Line 515, ./lib/monkey_patching/date.rb'><pre><a name='515' class='line_number'> 515</a>     day_type
</pre></code><code title='Line 516, ./lib/monkey_patching/date.rb'><pre><a name='516' class='line_number'> 516</a>   end
</pre></code><p>Generate label for the day type in the Lords in a session.</p>
<code title='Line 519, ./lib/monkey_patching/date.rb'><pre><a name='519' class='line_number'> 519</a>   def lords_day_type
</pre></code><code title='Line 520, ./lib/monkey_patching/date.rb'><pre><a name='520' class='line_number'> 520</a>     if self.is_lords_parliamentary_sitting_day?
</pre></code><code title='Line 521, ./lib/monkey_patching/date.rb'><pre><a name='521' class='line_number'> 521</a>       day_type = 'Sitting day'
</pre></code><code title='Line 522, ./lib/monkey_patching/date.rb'><pre><a name='522' class='line_number'> 522</a>     elsif self.is_lords_virtual_sitting_day?
</pre></code><code title='Line 523, ./lib/monkey_patching/date.rb'><pre><a name='523' class='line_number'> 523</a>       day_type = 'Virtual sitting day'
</pre></code><code title='Line 524, ./lib/monkey_patching/date.rb'><pre><a name='524' class='line_number'> 524</a>     elsif self.is_lords_praying_sitting_day?
</pre></code><code title='Line 525, ./lib/monkey_patching/date.rb'><pre><a name='525' class='line_number'> 525</a>       day_type = "Sitting praying day"
</pre></code><code title='Line 526, ./lib/monkey_patching/date.rb'><pre><a name='526' class='line_number'> 526</a>     elsif self.is_lords_praying_adjournment_day?( 4 )
</pre></code><code title='Line 527, ./lib/monkey_patching/date.rb'><pre><a name='527' class='line_number'> 527</a>       day_type = 'Praying adjournment day'
</pre></code><code title='Line 528, ./lib/monkey_patching/date.rb'><pre><a name='528' class='line_number'> 528</a>     elsif self.is_lords_adjournment_day?
</pre></code><code title='Line 529, ./lib/monkey_patching/date.rb'><pre><a name='529' class='line_number'> 529</a>       day_type = 'Adjournment day'
</pre></code><code title='Line 530, ./lib/monkey_patching/date.rb'><pre><a name='530' class='line_number'> 530</a>     end
</pre></code><code title='Line 531, ./lib/monkey_patching/date.rb'><pre><a name='531' class='line_number'> 531</a>     day_type
</pre></code><code title='Line 532, ./lib/monkey_patching/date.rb'><pre><a name='532' class='line_number'> 532</a>   end
</pre></code><p>Generate a label to say whether it&#39;s a praying day in the Commons or not.</p>
<code title='Line 535, ./lib/monkey_patching/date.rb'><pre><a name='535' class='line_number'> 535</a>   def is_commons_praying_day_label
</pre></code><code title='Line 536, ./lib/monkey_patching/date.rb'><pre><a name='536' class='line_number'> 536</a>     if self.is_commons_praying_day?
</pre></code><code title='Line 537, ./lib/monkey_patching/date.rb'><pre><a name='537' class='line_number'> 537</a>       label = 'True'
</pre></code><code title='Line 538, ./lib/monkey_patching/date.rb'><pre><a name='538' class='line_number'> 538</a>     else
</pre></code><code title='Line 539, ./lib/monkey_patching/date.rb'><pre><a name='539' class='line_number'> 539</a>       label = 'False'
</pre></code><code title='Line 540, ./lib/monkey_patching/date.rb'><pre><a name='540' class='line_number'> 540</a>     end
</pre></code><code title='Line 541, ./lib/monkey_patching/date.rb'><pre><a name='541' class='line_number'> 541</a>     label
</pre></code><code title='Line 542, ./lib/monkey_patching/date.rb'><pre><a name='542' class='line_number'> 542</a>   end
</pre></code><p>Generate a label to say whether it&#39;s a praying day in the Lords or not.</p>
<code title='Line 545, ./lib/monkey_patching/date.rb'><pre><a name='545' class='line_number'> 545</a>   def is_lords_praying_day_label
</pre></code><code title='Line 546, ./lib/monkey_patching/date.rb'><pre><a name='546' class='line_number'> 546</a>     if self.is_lords_praying_day?
</pre></code><code title='Line 547, ./lib/monkey_patching/date.rb'><pre><a name='547' class='line_number'> 547</a>       label = 'True'
</pre></code><code title='Line 548, ./lib/monkey_patching/date.rb'><pre><a name='548' class='line_number'> 548</a>     else
</pre></code><code title='Line 549, ./lib/monkey_patching/date.rb'><pre><a name='549' class='line_number'> 549</a>       label = 'False'
</pre></code><code title='Line 550, ./lib/monkey_patching/date.rb'><pre><a name='550' class='line_number'> 550</a>     end
</pre></code><code title='Line 551, ./lib/monkey_patching/date.rb'><pre><a name='551' class='line_number'> 551</a>     label
</pre></code><code title='Line 552, ./lib/monkey_patching/date.rb'><pre><a name='552' class='line_number'> 552</a>   end
</pre></code><code title='Line 553, ./lib/monkey_patching/date.rb'><pre><a name='553' class='line_number'> 553</a> end</pre></code></body></html>