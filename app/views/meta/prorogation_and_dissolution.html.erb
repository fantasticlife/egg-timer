<%= content_tag( 'h1', 'What to do at prorogation and dissolution' ) %>

<%= content_tag( 'p', 'At the end of a session, Parliament prorogues. Prorogation is the formal end to the parliamentary year.  At the end of a parliament period, Parliament dissolves. Dissolution is the official term for the end of a Parliament before a general election. Dissolution may be preceded by a short period of prorogation.' ) %>

<%= content_tag( 'p', "Our Google calendars are designed to cope with periods when Parliament is in session. They allow us to state when a House is sitting, sitting virtually or adjourned. Adjournment includes 'non-sitting Fridays', weekends, bank holidays and recess." ) %>

<%= content_tag( 'p', 'The calendars are not designed to cope with periods when Parliament is either prorogued or dissolved. Upon announcement of these periods certain actions should be taken.' ) %>

<%= content_tag( 'h2', 'What to do upon the announcement of prorogation or dissolution' ) %>

<%= content_tag( 'p', "In both cases, action must be taken to:" ) %>
<ol>
	<%= content_tag( 'li', "Remove any previously created sitting or adjournment days set to take place during the prorogation or the dissolution period from the Google calendars." ) %>
	<%= content_tag( 'li', "Check that these changes have propagated to the application. This should take no longer than 15 minutes." ) %>
	<%= content_tag( 'li', "Pause the application's syncing script." ) %>
	<%= content_tag( 'li', "Pull a copy of the database from Heroku." ) %>
	<%= content_tag( 'li', "Add data to the database by hand." ) %>
	<%= content_tag( 'li', "Push the updated database to Heroku." ) %>
	<%= content_tag( 'li', "Restart the syncing scripts." ) %>
</ol>
<%= content_tag( 'p', "In order to do this we need access to the Heroku account running the application." ) %>

<%= content_tag( 'p', "These are the steps to pause the applicationâ€™s syncing script and pull a copy of the database:
" )%>

<ol>
	<%= content_tag( 'li', 'Sign into Heroku.' ) %>
	<%= content_tag( 'li', 'Navigate to the application (parliament-calendar).' ) %>
	<%= content_tag( 'li', "Navigate to the 'Resources' tab." ) %>
	<%= content_tag( 'li', "Click on 'Heroku Scheduler'." ) %>
	<%= content_tag( 'li', "Click on the cross with tooltip 'Delete this job'. This will stop the application importing updates from the Google calendars until we've finished." ) %>
	<%= content_tag( 'li', "Open your terminal and navigate to the application directory." ) %>
	<%= content_tag( 'li', "Pull the database from Heroku by running #{content_tag( 'code', 'heroku pg:pull DATABASE_URL parliament_calendar' )}. This will give you an up to date copy of the database on your machine.".html_safe ) %>
	<%= content_tag( 'li', "In your terminal, run #{content_tag( 'code', 'psql parliament_calendar' )} to open the database.".html_safe ) %>
	<%= content_tag( 'li', "The database dump is taken as a backup in case things go wrong. It is not used for the rest of this task." ) %>
</ol>

<%= content_tag( 'h2', 'What to do upon the announcement of prorogation' ) %>

<%= content_tag( 'p', 'Prorogation is announced in a proclamation which gives a start date for the prorogation period. For the purposes of this calendar, the prorogation period starts on the day after the date of prorogation.' ) %>

<%= content_tag( 'p', "For prorogations between sessions in a parliament period, the proclamation also names the start date of the next session. For the purposes of this calendar, the prorogation period ends on the day before the start of the next session." ) %>

<%= content_tag( 'p', "A prorogation may immediately precede a dissolution. For the purposes of this calendar, the prorogation period ends on the day of dissolution as named in the dissolution proclamation." ) %>

<%= content_tag( 'p', "In order for the application to continue to function, we need to upload a clean copy of the database with an end date for the current session and a start date for the subsequent session." ) %>

<%= content_tag( 'p', "The steps are:" ) %>
<ol>
	<%= content_tag( 'li', "On the command line, navigate to the #{content_tag( 'code', 'parliament-calendar' )} application.".html_safe ) %>
	<%= content_tag( 'li', "Open #{content_tag( 'code', 'db/data/sessions.csv' )}.".html_safe ) %>
	<%= content_tag( 'li', "Add the end date of the current session to the first row.".html_safe ) %>
	<%= content_tag( 'li', "Add a new row before the first row of the CSV containing: the number of the current Parliament period, the number of the session in that Parliament and the start date of the session.".html_safe ) %>
	<%= content_tag( 'li', "Run #{content_tag( 'code', 'psql parliament_calendar < db/schema/setup.sql' )}.".html_safe ) %>
	<%= content_tag( 'li', "Run #{content_tag( 'code', 'rake setup' )}.".html_safe ) %>
	<%= content_tag( 'li', "Run #{content_tag( 'code', 'heroku maintenance:on' )} to switch the application to maintenance mode.".html_safe ) %>
	<%= content_tag( 'li', "Run #{content_tag( 'code', 'heroku pg:reset --confirm parliament-calendar' )} to reset the database: this removes information from the database.".html_safe ) %>
	<%= content_tag( 'li', "Run #{content_tag( 'code', 'heroku pg:push parliament_calendar DATABASE_URL' )} to push the new data to the database on Heroku.".html_safe ) %>
	<%= content_tag( 'li', "From 'Heroku Scheduler', click 'Create job'." ) %>
	<%= content_tag( 'li', "Enter the command #{content_tag( 'code', 'rake sync' )} in the 'Run Command' box.".html_safe ) %>
	<%= content_tag( 'li', "Wait until the scheduler job runs.." ) %>
	<%= content_tag( 'li', "Run #{content_tag( 'code', 'heroku maintenance:off' )} to switch the application out of maintenance mode.".html_safe ) %>
</ol>








<%= content_tag( 'h2', 'What to do upon the announcement of dissolution' ) %>

<%= content_tag( 'p', "If the dissolution is immediately preceded by a short prorogation period, we need to set an end date for the current session and create the prorogation period, following steps 1 to 5 above. If the dissolution period is not immediately preceded by a short prorogation period, we need to set an end date for the current session following steps 1 and 2 above." ) %>

<%= content_tag( 'p', " We then need to create a new dissolution period and a new parliament period." ) %>

<%= content_tag( 'p', " The steps are:" ) %>

<ol>
	<%= content_tag( 'li', "Find the number of the current parliament. Do this by running #{content_tag( 'code','select * from parliament_periods order by start_date desc limit 1;' )}.".html_safe ) %>
	<%= content_tag( 'li', "Create a new dissolution period. Do this by running: #{content_tag( 'code', "insert into dissolution_periods(number, start_date, end_date) values (NUMBER, 'START_DATE', 'END_DATE');")} where NUMBER is the number of the current parliament, START DATE is the day following the dissolution date as named in the dissolution proclamation and END_DATE is the day before Parliament returns from dissolution as named in the dissolution proclamation.".html_safe ) %>
	<%= content_tag( 'li', "Run a rake task to populate dissolution days from the dissolution period. Note that this script does not exist yet and will need to be written when the next dissolution is announced." ) %>
</ol>






